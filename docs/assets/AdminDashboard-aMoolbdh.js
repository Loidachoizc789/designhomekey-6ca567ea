import{k as $,r as h,j as e,t as q,q as b,E as v,I as E,B as w,V as re,X as le,J as Ge,K as ye,N as Ne,R as L,O as ce,Q as oe,U as Ye,W as be,Y as W,Z as Xe,_ as Qe,$ as We,a0 as Je,a1 as Ze,a2 as ie,D as es,T as ss,g as ts,h as K,H as as,i as B}from"./index-Cz-rwPxk.js";import{L as I,a as M}from"./label-zMVBXziF.js";import{D as F,e as de,a as G,b as Y,c as X,I as se}from"./dialog-C0dmiONS.js";import{I as H}from"./image-MRwlfU1f.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=$("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=$("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=$("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=$("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=$("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=$("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=$("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=$("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=$("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=$("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),he=h.forwardRef(({className:t,...c},o)=>e.jsx("textarea",{className:q("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:o,...c}));he.displayName="Textarea";const ds=({productId:t})=>{const[c,o]=h.useState([]),[f,x]=h.useState(!0),[g,u]=h.useState(!1);h.useEffect(()=>{j();const i=b.channel(`product-media-${t}`).on("postgres_changes",{event:"*",schema:"public",table:"product_media",filter:`product_id=eq.${t}`},()=>j()).subscribe();return()=>{b.removeChannel(i)}},[t]);const j=async()=>{try{x(!0);const{data:i,error:y}=await b.from("product_media").select("*").eq("product_id",t).order("display_order",{ascending:!0});if(y)throw y;o(i||[])}catch(i){console.error("Error fetching media:",i),v({title:"Lỗi",description:"Không thể tải media",variant:"destructive"})}finally{x(!1)}},r=async i=>{var p;const y=i.target.files;if(!(!y||y.length===0)){u(!0);try{for(let C=0;C<y.length;C++){const D=y[C];if(D.size>50*1024*1024){v({title:"Lỗi",description:`${D.name} quá lớn. Tối đa 50MB.`,variant:"destructive"});continue}const T=(p=D.name.split(".").pop())==null?void 0:p.toLowerCase(),n=`products/${t}/${Date.now()}_${C}.${T}`,k=["mp4","webm","mov"].includes(T||""),{error:S}=await b.storage.from("category-images").upload(n,D);if(S){console.error("Upload error:",S);continue}const{data:N}=b.storage.from("category-images").getPublicUrl(n),{error:A}=await b.from("product_media").insert({product_id:t,media_url:N.publicUrl,media_type:k?"video":"image",display_order:c.length+C});A&&console.error("Insert error:",A)}v({title:"Thành công",description:`Đã upload ${y.length} file`}),j()}catch(C){console.error("Upload error:",C),v({title:"Lỗi upload",description:"Không thể upload file",variant:"destructive"})}finally{u(!1),i.target.value=""}}},s=async i=>{if(!i)return;const y=i.match(/\.(mp4|webm|mov)$/i);try{const{error:p}=await b.from("product_media").insert({product_id:t,media_url:i,media_type:y?"video":"image",display_order:c.length});if(p)throw p;v({title:"Đã thêm media"}),j()}catch(p){console.error("Add URL error:",p),v({title:"Lỗi",description:"Không thể thêm media",variant:"destructive"})}},l=async i=>{if(confirm("Xóa media này?"))try{const{error:y}=await b.from("product_media").delete().eq("id",i);if(y)throw y;v({title:"Đã xóa media"}),j()}catch(y){console.error("Delete error:",y),v({title:"Lỗi",description:"Không thể xóa media",variant:"destructive"})}},[a,d]=h.useState("");return f?e.jsx("div",{className:"py-8 text-center",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-primary mx-auto"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"glass-card p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Thêm Media (Không giới hạn số lượng)"]}),e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center mb-4",children:[e.jsx(E,{type:"file",accept:"image/*,video/*",onChange:r,className:"hidden",id:"multi-file-upload",multiple:!0,disabled:g}),e.jsx("label",{htmlFor:"multi-file-upload",className:"cursor-pointer flex flex-col items-center gap-2",children:g?e.jsx(I,{className:"w-8 h-8 animate-spin text-primary"}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-8 h-8 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Click để upload nhiều ảnh/video (max 50MB mỗi file)"})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{value:a,onChange:i=>d(i.target.value),placeholder:"Hoặc dán URL ảnh/video...",className:"flex-1"}),e.jsxs(w,{onClick:()=>{s(a),d("")},disabled:!a,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Thêm URL"]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-4",children:["Thư viện media (",c.length," items)"]}),c.length===0?e.jsxs("div",{className:"glass-card p-8 text-center",children:[e.jsx(H,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"Chưa có media nào"})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3",children:c.map((i,y)=>e.jsxs("div",{className:"relative group aspect-square rounded-lg overflow-hidden border border-border bg-card",children:[i.media_type==="video"?e.jsx("video",{src:i.media_url,className:"w-full h-full object-cover",muted:!0,onMouseEnter:p=>p.currentTarget.play(),onMouseLeave:p=>{p.currentTarget.pause(),p.currentTarget.currentTime=0}}):e.jsx("img",{src:i.media_url,alt:`Media ${y+1}`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute top-1 left-1",children:i.media_type==="video"?e.jsx("div",{className:"w-6 h-6 rounded bg-red-500/80 flex items-center justify-center",children:e.jsx(re,{className:"w-3 h-3 text-white"})}):e.jsx("div",{className:"w-6 h-6 rounded bg-blue-500/80 flex items-center justify-center",children:e.jsx(H,{className:"w-3 h-3 text-white"})})}),e.jsx("div",{className:"absolute top-1 right-1 w-6 h-6 rounded bg-background/80 flex items-center justify-center text-xs font-medium",children:y+1}),e.jsx("div",{className:"absolute inset-0 bg-background/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx(w,{size:"sm",variant:"destructive",onClick:()=>l(i.id),children:e.jsx(V,{className:"w-4 h-4"})})})]},i.id))})]})]})},ms=({categorySlug:t})=>{const[c,o]=h.useState([]),[f,x]=h.useState(!0),[g,u]=h.useState(!1),[j,r]=h.useState(!1),[s,l]=h.useState(!1),[a,d]=h.useState(null),[i,y]=h.useState(null),[p,C]=h.useState({title:"",description:"",image_url:""});h.useEffect(()=>{D()},[t]);const D=async()=>{try{x(!0);const{data:m,error:_}=await b.from("category_images").select("*").eq("category_slug",t).order("display_order",{ascending:!0});if(_)throw _;o(m||[])}catch(m){console.error("Error fetching images:",m),v({title:"Lỗi",description:"Không thể tải danh sách ảnh",variant:"destructive"})}finally{x(!1)}},T=async m=>{var U;const _=(U=m.target.files)==null?void 0:U[0];if(_){if(_.size>50*1024*1024){v({title:"Lỗi",description:"File quá lớn. Tối đa 50MB.",variant:"destructive"});return}u(!0);try{const O=_.name.split(".").pop(),xe=`${t}/${Date.now()}.${O}`,{error:fe}=await b.storage.from("category-images").upload(xe,_);if(fe)throw fe;const{data:Fe}=b.storage.from("category-images").getPublicUrl(xe);C({...p,image_url:Fe.publicUrl}),v({title:"Thành công",description:"Đã upload ảnh"})}catch(O){console.error("Upload error:",O),v({title:"Lỗi upload",description:"Không thể upload ảnh",variant:"destructive"})}finally{u(!1)}}},n=async m=>{if(m.preventDefault(),!p.title||!p.image_url){v({title:"Lỗi",description:"Vui lòng điền tiêu đề và upload ảnh",variant:"destructive"});return}try{if(i){const{error:_}=await b.from("category_images").update({title:p.title,description:p.description||null,image_url:p.image_url}).eq("id",i.id);if(_)throw _;v({title:"Đã cập nhật ảnh"})}else{const{error:_}=await b.from("category_images").insert({title:p.title,description:p.description||null,image_url:p.image_url,category_slug:t,display_order:c.length});if(_)throw _;v({title:"Đã thêm ảnh mới"})}r(!1),y(null),C({title:"",description:"",image_url:""}),D()}catch(_){console.error("Save error:",_),v({title:"Lỗi",description:"Không thể lưu ảnh",variant:"destructive"})}},k=m=>{y(m),C({title:m.title,description:m.description||"",image_url:m.image_url}),r(!0)},S=async m=>{if(confirm("Bạn có chắc muốn xóa ảnh này?"))try{const{error:_}=await b.from("category_images").delete().eq("id",m);if(_)throw _;v({title:"Đã xóa ảnh"}),D()}catch(_){console.error("Delete error:",_),v({title:"Lỗi",description:"Không thể xóa ảnh",variant:"destructive"})}},N=()=>{y(null),C({title:"",description:"",image_url:""}),r(!0)},A=m=>{d(m),l(!0)};return f?e.jsx("div",{className:"glass-card p-8 text-center",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-primary mx-auto"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"font-display text-xl font-semibold",children:["Ảnh danh mục: ",e.jsx("span",{className:"text-primary",children:t})]}),e.jsxs(F,{open:j,onOpenChange:r,children:[e.jsx(de,{asChild:!0,children:e.jsxs(w,{onClick:N,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Thêm sản phẩm"]})}),e.jsxs(G,{className:"max-w-lg",children:[e.jsx(Y,{children:e.jsx(X,{children:i?"Chỉnh sửa sản phẩm":"Thêm sản phẩm mới"})}),e.jsxs("form",{onSubmit:n,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Tiêu đề *"}),e.jsx(E,{value:p.title,onChange:m=>C({...p,title:m.target.value}),placeholder:"Tên sản phẩm/ảnh",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Mô tả"}),e.jsx(he,{value:p.description,onChange:m=>C({...p,description:m.target.value}),placeholder:"Mô tả ngắn về sản phẩm",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Ảnh đại diện *"}),p.image_url?e.jsxs("div",{className:"relative",children:[p.image_url.match(/\.(mp4|webm|mov)$/i)?e.jsx("div",{className:"w-full h-48 bg-card flex items-center justify-center rounded-lg",children:e.jsx(re,{className:"w-12 h-12 text-muted-foreground"})}):e.jsx("img",{src:p.image_url,alt:"Preview",className:"w-full h-48 object-cover rounded-lg"}),e.jsx(w,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>C({...p,image_url:""}),children:e.jsx(le,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-border rounded-lg p-8 text-center",children:[e.jsx(E,{type:"file",accept:"image/*,video/*",onChange:T,className:"hidden",id:"file-upload",disabled:g}),e.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer flex flex-col items-center gap-2",children:g?e.jsx(I,{className:"w-8 h-8 animate-spin text-primary"}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-8 h-8 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Click để upload (max 50MB)"})]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Hoặc dán URL ảnh trực tiếp:"}),e.jsx(E,{value:p.image_url,onChange:m=>C({...p,image_url:m.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Hủy"}),e.jsx(w,{type:"submit",children:i?"Cập nhật":"Thêm"})]})]})]})]})]}),c.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(H,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Chưa có ảnh nào trong danh mục này"}),e.jsxs(w,{className:"mt-4",onClick:N,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Thêm sản phẩm đầu tiên"]})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:c.map(m=>e.jsxs("div",{className:"glass-card overflow-hidden group",children:[e.jsxs("div",{className:"relative aspect-video",children:[m.image_url.match(/\.(mp4|webm|mov)$/i)?e.jsx("div",{className:"w-full h-full bg-card flex items-center justify-center",children:e.jsx(re,{className:"w-12 h-12 text-muted-foreground"})}):e.jsx("img",{src:m.image_url,alt:m.title,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute inset-0 bg-background/80 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx(w,{size:"sm",variant:"secondary",onClick:()=>k(m),children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx(w,{size:"sm",variant:"default",onClick:()=>A(m),children:e.jsx(se,{className:"w-4 h-4"})}),e.jsx(w,{size:"sm",variant:"destructive",onClick:()=>S(m.id),children:e.jsx(V,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-sm truncate",children:m.title}),e.jsxs(w,{variant:"ghost",size:"sm",className:"text-xs text-primary",onClick:()=>A(m),children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"Media"]})]}),m.description&&e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-1",children:m.description})]})]},m.id))}),e.jsx(F,{open:s,onOpenChange:l,children:e.jsxs(G,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-primary"}),"Quản lý Media: ",a==null?void 0:a.title]})}),a&&e.jsx(ds,{productId:a.id})]})})]})};var P="Accordion",hs=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[ue,us,ps]=Ge(P),[J,Vs]=ye(P,[ps,Ne]),pe=Ne(),we=L.forwardRef((t,c)=>{const{type:o,...f}=t,x=f,g=f;return e.jsx(ue.Provider,{scope:t.__scopeAccordion,children:o==="multiple"?e.jsx(vs,{...g,ref:c}):e.jsx(fs,{...x,ref:c})})});we.displayName=P;var[Ce,gs]=J(P),[_e,xs]=J(P,{collapsible:!1}),fs=L.forwardRef((t,c)=>{const{value:o,defaultValue:f,onValueChange:x=()=>{},collapsible:g=!1,...u}=t,[j,r]=ce({prop:o,defaultProp:f??"",onChange:x,caller:P});return e.jsx(Ce,{scope:t.__scopeAccordion,value:L.useMemo(()=>j?[j]:[],[j]),onItemOpen:r,onItemClose:L.useCallback(()=>g&&r(""),[g,r]),children:e.jsx(_e,{scope:t.__scopeAccordion,collapsible:g,children:e.jsx(ke,{...u,ref:c})})})}),vs=L.forwardRef((t,c)=>{const{value:o,defaultValue:f,onValueChange:x=()=>{},...g}=t,[u,j]=ce({prop:o,defaultProp:f??[],onChange:x,caller:P}),r=L.useCallback(l=>j((a=[])=>[...a,l]),[j]),s=L.useCallback(l=>j((a=[])=>a.filter(d=>d!==l)),[j]);return e.jsx(Ce,{scope:t.__scopeAccordion,value:u,onItemOpen:r,onItemClose:s,children:e.jsx(_e,{scope:t.__scopeAccordion,collapsible:!0,children:e.jsx(ke,{...g,ref:c})})})}),[js,Z]=J(P),ke=L.forwardRef((t,c)=>{const{__scopeAccordion:o,disabled:f,dir:x,orientation:g="vertical",...u}=t,j=L.useRef(null),r=oe(j,c),s=us(o),a=Ye(x)==="ltr",d=be(t.onKeyDown,i=>{var m;if(!hs.includes(i.key))return;const y=i.target,p=s().filter(_=>{var U;return!((U=_.ref.current)!=null&&U.disabled)}),C=p.findIndex(_=>_.ref.current===y),D=p.length;if(C===-1)return;i.preventDefault();let T=C;const n=0,k=D-1,S=()=>{T=C+1,T>k&&(T=n)},N=()=>{T=C-1,T<n&&(T=k)};switch(i.key){case"Home":T=n;break;case"End":T=k;break;case"ArrowRight":g==="horizontal"&&(a?S():N());break;case"ArrowDown":g==="vertical"&&S();break;case"ArrowLeft":g==="horizontal"&&(a?N():S());break;case"ArrowUp":g==="vertical"&&N();break}const A=T%D;(m=p[A].ref.current)==null||m.focus()});return e.jsx(js,{scope:o,disabled:f,direction:x,orientation:g,children:e.jsx(ue.Slot,{scope:o,children:e.jsx(W.div,{...u,"data-orientation":g,ref:r,onKeyDown:f?void 0:d})})})}),Q="AccordionItem",[ys,ge]=J(Q),Se=L.forwardRef((t,c)=>{const{__scopeAccordion:o,value:f,...x}=t,g=Z(Q,o),u=gs(Q,o),j=pe(o),r=Xe(),s=f&&u.value.includes(f)||!1,l=g.disabled||t.disabled;return e.jsx(ys,{scope:o,open:s,disabled:l,triggerId:r,children:e.jsx(Qe,{"data-orientation":g.orientation,"data-state":Ie(s),...j,...x,ref:c,disabled:l,open:s,onOpenChange:a=>{a?u.onItemOpen(f):u.onItemClose(f)}})})});Se.displayName=Q;var Ae="AccordionHeader",De=L.forwardRef((t,c)=>{const{__scopeAccordion:o,...f}=t,x=Z(P,o),g=ge(Ae,o);return e.jsx(W.h3,{"data-orientation":x.orientation,"data-state":Ie(g.open),"data-disabled":g.disabled?"":void 0,...f,ref:c})});De.displayName=Ae;var ne="AccordionTrigger",Te=L.forwardRef((t,c)=>{const{__scopeAccordion:o,...f}=t,x=Z(P,o),g=ge(ne,o),u=xs(ne,o),j=pe(o);return e.jsx(ue.ItemSlot,{scope:o,children:e.jsx(We,{"aria-disabled":g.open&&!u.collapsible||void 0,"data-orientation":x.orientation,id:g.triggerId,...j,...f,ref:c})})});Te.displayName=ne;var Ee="AccordionContent",Me=L.forwardRef((t,c)=>{const{__scopeAccordion:o,...f}=t,x=Z(P,o),g=ge(Ee,o),u=pe(o);return e.jsx(Je,{role:"region","aria-labelledby":g.triggerId,"data-orientation":x.orientation,...u,...f,ref:c,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...t.style}})});Me.displayName=Ee;function Ie(t){return t?"open":"closed"}var Ns=we,bs=Se,ws=De,Le=Te,Pe=Me;const Cs=Ns,Re=h.forwardRef(({className:t,...c},o)=>e.jsx(bs,{ref:o,className:q("border-b",t),...c}));Re.displayName="AccordionItem";const $e=h.forwardRef(({className:t,children:c,...o},f)=>e.jsx(ws,{className:"flex",children:e.jsxs(Le,{ref:f,className:q("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...o,children:[c,e.jsx(is,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));$e.displayName=Le.displayName;const Ue=h.forwardRef(({className:t,children:c,...o},f)=>e.jsx(Pe,{ref:f,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...o,children:e.jsx("div",{className:q("pb-4 pt-0",t),children:c})}));Ue.displayName=Pe.displayName;const ve=[{slug:"thiet-ke-2d",name:"Thiết Kế 2D"},{slug:"3d-virtual",name:"3D Virtual"},{slug:"3d-event",name:"3D Event"},{slug:"model-3d",name:"Model 3D"},{slug:"noi-that",name:"Nội Thất"},{slug:"ngoai-that",name:"Ngoại Thất"},{slug:"after-effects",name:"After Effects"}],_s=()=>{const[t,c]=h.useState([]),[o,f]=h.useState({}),[x,g]=h.useState(!0),[u,j]=h.useState(ve[0].slug),[r,s]=h.useState(!1),[l,a]=h.useState(null),[d,i]=h.useState({service_name:"",items:[{label:"",price:""}]});h.useEffect(()=>{y()},[u]);const y=async()=>{try{g(!0);const{data:N,error:A}=await b.from("category_pricing").select("*").eq("category_slug",u).order("display_order",{ascending:!0});if(A)throw A;const m=(N||[]).map(O=>({...O,items:Array.isArray(O.items)?O.items:[]}));c(m);const{data:_,error:U}=await b.from("category_pricing_notes").select("*").eq("category_slug",u).single();if(U&&U.code!=="PGRST116")throw U;_&&f(O=>({...O,[u]:{id:_.id,includes:_.includes||[],excludes:_.excludes||[],category_slug:u}}))}catch(N){console.error("Error fetching pricing:",N)}finally{g(!1)}},p=()=>{i({...d,items:[...d.items,{label:"",price:""}]})},C=N=>{i({...d,items:d.items.filter((A,m)=>m!==N)})},D=(N,A,m)=>{const _=[...d.items];_[N][A]=m,i({...d,items:_})},T=async N=>{if(N.preventDefault(),!d.service_name||d.items.length===0){v({title:"Lỗi",description:"Vui lòng điền tên dịch vụ và ít nhất 1 mục giá",variant:"destructive"});return}const A=d.items.filter(m=>m.label&&m.price);try{if(l){const{error:m}=await b.from("category_pricing").update({service_name:d.service_name,items:A}).eq("id",l.id);if(m)throw m;v({title:"Đã cập nhật bảng giá"})}else{const{error:m}=await b.from("category_pricing").insert({service_name:d.service_name,items:A,category_slug:u,display_order:t.length});if(m)throw m;v({title:"Đã thêm bảng giá mới"})}s(!1),a(null),i({service_name:"",items:[{label:"",price:""}]}),y()}catch(m){console.error("Save error:",m),v({title:"Lỗi",description:"Không thể lưu bảng giá",variant:"destructive"})}},n=N=>{a(N),i({service_name:N.service_name,items:N.items.length>0?N.items:[{label:"",price:""}]}),s(!0)},k=async N=>{if(confirm("Bạn có chắc muốn xóa bảng giá này?"))try{const{error:A}=await b.from("category_pricing").delete().eq("id",N);if(A)throw A;v({title:"Đã xóa bảng giá"}),y()}catch(A){console.error("Delete error:",A),v({title:"Lỗi",description:"Không thể xóa bảng giá",variant:"destructive"})}},S=()=>{a(null),i({service_name:"",items:[{label:"",price:""}]}),s(!0)};return x?e.jsx("div",{className:"glass-card p-8 text-center",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-primary mx-auto"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"glass-card p-4",children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Chọn danh mục"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ve.map(N=>e.jsx(w,{variant:u===N.slug?"default":"outline",size:"sm",onClick:()=>j(N.slug),children:N.name},N.slug))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"font-display text-xl font-semibold",children:["Bảng giá: ",e.jsx("span",{className:"text-primary",children:u})]}),e.jsxs(F,{open:r,onOpenChange:s,children:[e.jsx(de,{asChild:!0,children:e.jsxs(w,{onClick:S,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Thêm bảng giá"]})}),e.jsxs(G,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsx(X,{children:l?"Chỉnh sửa bảng giá":"Thêm bảng giá mới"})}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Tên nhóm dịch vụ *"}),e.jsx(E,{value:d.service_name,onChange:N=>i({...d,service_name:N.target.value}),placeholder:"VD: Logo Animation",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Các mục giá"}),e.jsx("div",{className:"space-y-3",children:d.items.map((N,A)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(E,{value:N.label,onChange:m=>D(A,"label",m.target.value),placeholder:"Tên dịch vụ",className:"flex-1"}),e.jsx(E,{value:N.price,onChange:m=>D(A,"price",m.target.value),placeholder:"Giá (VD: 2.000.000đ)",className:"flex-1"}),d.items.length>1&&e.jsx(w,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(A),children:e.jsx(V,{className:"w-4 h-4 text-destructive"})})]},A))}),e.jsxs(w,{type:"button",variant:"outline",size:"sm",onClick:p,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Thêm mục"]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Hủy"}),e.jsx(w,{type:"submit",children:l?"Cập nhật":"Thêm"})]})]})]})]})]}),t.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"Chưa có bảng giá nào trong danh mục này"}),e.jsxs(w,{className:"mt-4",onClick:S,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Thêm bảng giá đầu tiên"]})]}):e.jsx(Cs,{type:"multiple",className:"space-y-4",children:t.map(N=>e.jsxs(Re,{value:N.id,className:"glass-card border-none",children:[e.jsx($e,{className:"px-6 py-4 hover:no-underline",children:e.jsxs("div",{className:"flex items-center justify-between w-full pr-4",children:[e.jsx("span",{className:"font-semibold text-primary",children:N.service_name}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[N.items.length," mục"]})]})}),e.jsxs(Ue,{className:"px-6 pb-4",children:[e.jsx("div",{className:"space-y-2 mb-4",children:N.items.map((A,m)=>e.jsxs("div",{className:"flex justify-between p-2 bg-card/50 rounded",children:[e.jsx("span",{children:A.label}),e.jsx("span",{className:"text-primary font-medium",children:A.price})]},m))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>n(N),children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Sửa"]}),e.jsxs(w,{size:"sm",variant:"destructive",onClick:()=>k(N.id),children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Xóa"]})]})]})]},N.id))})]})},te=["phim-truong-3d","thiet-ke-2d","model-3d","noi-ngoai-that","after-effects"],ks=()=>{const[t,c]=h.useState([]),[o,f]=h.useState(!0),[x,g]=h.useState(null);h.useState(!1),h.useEffect(()=>{u()},[]);const u=async()=>{try{f(!0);const{data:a,error:d}=await b.from("categories").select("*").in("slug",te).order("display_order",{ascending:!0});if(d)throw d;if(!a||a.length===0){await j();return}const i=[...a].sort((y,p)=>te.indexOf(y.slug)-te.indexOf(p.slug));c(i)}catch(a){console.error("Error fetching categories:",a),v({title:"Lỗi",description:"Không thể tải danh sách danh mục",variant:"destructive"})}finally{f(!1)}},j=async()=>{try{const a=[{name:"Thiết Kế 3D",slug:"phim-truong-3d",description:"Talkshow, Livestream bán hàng, TV show, Event – sân khấu ảo, Showroom ảo",display_order:1},{name:"Thiết Kế 2D",slug:"thiet-ke-2d",description:"Key visual chương trình, Backdrop sự kiện, Visual livestream, Layout màn LED, POSM",display_order:2},{name:"Model 3D / Asset",slug:"model-3d",description:"Props sân khấu, Nội thất 3D, Background modular, Asset tối ưu UE5 / Blender",display_order:3},{name:"Nội Ngoại Thất",slug:"noi-ngoai-that",description:"Render 3D nội thất căn hộ, biệt thự, văn phòng và phối cảnh ngoại thất mặt tiền",display_order:4},{name:"After Effects",slug:"after-effects",description:"Motion logo, video quảng cáo, template AE, gói livestream visual, lower third",display_order:5}];for(const d of a)await b.from("categories").upsert(d,{onConflict:"slug"});u()}catch(a){console.error("Error creating default categories:",a)}},r=async(a,d)=>{var y;const i=(y=d.target.files)==null?void 0:y[0];if(i){if(i.size>50*1024*1024){v({title:"Lỗi",description:"File quá lớn. Tối đa 50MB.",variant:"destructive"});return}g(a);try{const p=i.name.split(".").pop(),C=`homepage/${a}-${Date.now()}.${p}`,{error:D}=await b.storage.from("category-images").upload(C,i);if(D)throw D;const{data:T}=b.storage.from("category-images").getPublicUrl(C),{error:n}=await b.from("categories").update({home_image_url:T.publicUrl}).eq("id",a);if(n)throw n;v({title:"Đã upload và cập nhật ảnh"}),u()}catch(p){console.error("Upload error:",p),v({title:"Lỗi upload",description:"Không thể upload ảnh",variant:"destructive"})}finally{g(null)}}},s=async a=>{try{const{error:d}=await b.from("categories").update({home_image_url:null}).eq("id",a);if(d)throw d;v({title:"Đã xóa ảnh"}),u()}catch(d){console.error("Remove error:",d),v({title:"Lỗi",description:"Không thể xóa ảnh",variant:"destructive"})}},l=async(a,d)=>{try{const{error:i}=await b.from("categories").update({description:d}).eq("id",a);if(i)throw i;c(y=>y.map(p=>p.id===a?{...p,description:d}:p))}catch(i){console.error("Update error:",i)}};return o?e.jsx("div",{className:"glass-card p-8 text-center",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-primary mx-auto"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h2",{className:"font-display text-xl font-semibold",children:"Quản lý ảnh trang chủ"})}),e.jsx("p",{className:"text-muted-foreground",children:"Cập nhật ảnh đại diện cho từng danh mục hiển thị trên trang chủ"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(a=>e.jsxs("div",{className:"glass-card overflow-hidden",children:[e.jsx("div",{className:"relative aspect-video bg-card",children:a.home_image_url?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:a.home_image_url,alt:a.name,className:"w-full h-full object-cover"}),e.jsx(w,{size:"sm",variant:"destructive",className:"absolute top-2 right-2",onClick:()=>s(a.id),children:e.jsx(le,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"w-full h-full flex items-center justify-center",children:[e.jsx(E,{type:"file",accept:"image/*",onChange:d=>r(a.id,d),className:"hidden",id:`upload-${a.id}`,disabled:x===a.id}),e.jsx("label",{htmlFor:`upload-${a.id}`,className:"cursor-pointer flex flex-col items-center gap-2",children:x===a.id?e.jsx(I,{className:"w-8 h-8 animate-spin text-primary"}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-8 h-8 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Click để upload"})]})})]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("h3",{className:"font-semibold text-primary",children:a.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Slug: ",a.slug]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"text-xs",children:"Mô tả (hiển thị trên trang chủ)"}),e.jsx(E,{value:a.description||"",onChange:d=>l(a.id,d.target.value),placeholder:"Mô tả ngắn...",className:"text-sm"})]}),a.home_image_url&&e.jsxs("div",{className:"pt-2",children:[e.jsx(E,{type:"file",accept:"image/*",onChange:d=>r(a.id,d),className:"hidden",id:`replace-${a.id}`,disabled:x===a.id}),e.jsx("label",{htmlFor:`replace-${a.id}`,children:e.jsx(w,{variant:"outline",size:"sm",className:"w-full",asChild:!0,children:e.jsxs("span",{children:[x===a.id?e.jsx(I,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(z,{className:"w-4 h-4 mr-2"}),"Thay đổi ảnh"]})})})]})]})]},a.id))})]})};function Ss(t){const c=h.useRef({value:t,previous:t});return h.useMemo(()=>(c.current.value!==t&&(c.current.previous=c.current.value,c.current.value=t),c.current.previous),[t])}var ee="Switch",[As,zs]=ye(ee),[Ds,Ts]=As(ee),Oe=h.forwardRef((t,c)=>{const{__scopeSwitch:o,name:f,checked:x,defaultChecked:g,required:u,disabled:j,value:r="on",onCheckedChange:s,form:l,...a}=t,[d,i]=h.useState(null),y=oe(c,n=>i(n)),p=h.useRef(!1),C=d?l||!!d.closest("form"):!0,[D,T]=ce({prop:x,defaultProp:g??!1,onChange:s,caller:ee});return e.jsxs(Ds,{scope:o,checked:D,disabled:j,children:[e.jsx(W.button,{type:"button",role:"switch","aria-checked":D,"aria-required":u,"data-state":Ke(D),"data-disabled":j?"":void 0,disabled:j,value:r,...a,ref:y,onClick:be(t.onClick,n=>{T(k=>!k),C&&(p.current=n.isPropagationStopped(),p.current||n.stopPropagation())})}),C&&e.jsx(ze,{control:d,bubbles:!p.current,name:f,value:r,checked:D,required:u,disabled:j,form:l,style:{transform:"translateX(-100%)"}})]})});Oe.displayName=ee;var qe="SwitchThumb",Ve=h.forwardRef((t,c)=>{const{__scopeSwitch:o,...f}=t,x=Ts(qe,o);return e.jsx(W.span,{"data-state":Ke(x.checked),"data-disabled":x.disabled?"":void 0,...f,ref:c})});Ve.displayName=qe;var Es="SwitchBubbleInput",ze=h.forwardRef(({__scopeSwitch:t,control:c,checked:o,bubbles:f=!0,...x},g)=>{const u=h.useRef(null),j=oe(u,g),r=Ss(o),s=Ze(c);return h.useEffect(()=>{const l=u.current;if(!l)return;const a=window.HTMLInputElement.prototype,i=Object.getOwnPropertyDescriptor(a,"checked").set;if(r!==o&&i){const y=new Event("click",{bubbles:f});i.call(l,o),l.dispatchEvent(y)}},[r,o,f]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:o,...x,tabIndex:-1,ref:j,style:{...x.style,...s,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ze.displayName=Es;function Ke(t){return t?"checked":"unchecked"}var Be=Oe,Ms=Ve;const He=h.forwardRef(({className:t,...c},o)=>e.jsx(Be,{className:q("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",t),...c,ref:o,children:e.jsx(Ms,{className:q("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));He.displayName=Be.displayName;const ae=[{label:"Cyan → Blue",value:"from-cyan-500 to-blue-500"},{label:"Purple → Pink",value:"from-purple-500 to-pink-500"},{label:"Green → Cyan",value:"from-green-500 to-cyan-500"},{label:"Orange → Red",value:"from-orange-500 to-red-500"},{label:"Blue → Violet",value:"from-blue-500 to-violet-500"}],Is=()=>{const[t,c]=h.useState([]),[o,f]=h.useState(!0),[x,g]=h.useState(!1),[u,j]=h.useState(null),[r,s]=h.useState({name:"",description:"",price:"",includes:[""],color:ae[0].value,is_active:!0});h.useEffect(()=>{l()},[]);const l=async()=>{try{f(!0);const{data:n,error:k}=await b.from("combo_packages").select("*").order("display_order",{ascending:!0});if(k)throw k;c(n||[])}catch(n){console.error("Error fetching combos:",n),v({title:"Lỗi",description:"Không thể tải danh sách combo",variant:"destructive"})}finally{f(!1)}},a=()=>{s({...r,includes:[...r.includes,""]})},d=n=>{s({...r,includes:r.includes.filter((k,S)=>S!==n)})},i=(n,k)=>{const S=[...r.includes];S[n]=k,s({...r,includes:S})},y=async n=>{if(n.preventDefault(),!r.name||!r.price){v({title:"Lỗi",description:"Vui lòng điền tên và giá",variant:"destructive"});return}const k=r.includes.filter(S=>S.trim());try{if(u){const{error:S}=await b.from("combo_packages").update({name:r.name,description:r.description,price:r.price,includes:k,color:r.color,is_active:r.is_active}).eq("id",u.id);if(S)throw S;v({title:"Đã cập nhật combo"})}else{const{error:S}=await b.from("combo_packages").insert({name:r.name,description:r.description,price:r.price,includes:k,color:r.color,is_active:r.is_active,display_order:t.length});if(S)throw S;v({title:"Đã thêm combo mới"})}g(!1),j(null),D(),l()}catch(S){console.error("Save error:",S),v({title:"Lỗi",description:"Không thể lưu combo",variant:"destructive"})}},p=n=>{j(n),s({name:n.name,description:n.description,price:n.price,includes:n.includes.length>0?n.includes:[""],color:n.color,is_active:n.is_active}),g(!0)},C=async n=>{if(confirm("Bạn có chắc muốn xóa combo này?"))try{const{error:k}=await b.from("combo_packages").delete().eq("id",n);if(k)throw k;v({title:"Đã xóa combo"}),l()}catch(k){console.error("Delete error:",k),v({title:"Lỗi",description:"Không thể xóa combo",variant:"destructive"})}},D=()=>{s({name:"",description:"",price:"",includes:[""],color:ae[0].value,is_active:!0})},T=()=>{j(null),D(),g(!0)};return o?e.jsx("div",{className:"glass-card p-8 text-center",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-primary mx-auto"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"font-display text-xl font-semibold",children:["Quản lý ",e.jsx("span",{className:"text-primary",children:"Combo Packages"})]}),e.jsxs(F,{open:x,onOpenChange:g,children:[e.jsx(de,{asChild:!0,children:e.jsxs(w,{onClick:T,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Thêm combo"]})}),e.jsxs(G,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsx(X,{children:u?"Chỉnh sửa combo":"Thêm combo mới"})}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Tên combo *"}),e.jsx(E,{value:r.name,onChange:n=>s({...r,name:n.target.value}),placeholder:"VD: COMBO EVENT FULL",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Giá *"}),e.jsx(E,{value:r.price,onChange:n=>s({...r,price:n.target.value}),placeholder:"VD: 35.000.000 – 50.000.000đ",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Mô tả ngắn"}),e.jsx(he,{value:r.description,onChange:n=>s({...r,description:n.target.value}),placeholder:"VD: Gói bán chạy nhất",rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Màu gradient"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ae.map(n=>e.jsxs("button",{type:"button",onClick:()=>s({...r,color:n.value}),className:`px-3 py-2 rounded-lg text-sm border transition-all ${r.color===n.value?"border-primary bg-primary/20":"border-border hover:border-primary/50"}`,children:[e.jsx("span",{className:`inline-block w-4 h-4 rounded mr-2 bg-gradient-to-r ${n.value}`}),n.label]},n.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Bao gồm"}),e.jsx("div",{className:"space-y-2",children:r.includes.map((n,k)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{value:n,onChange:S=>i(k,S.target.value),placeholder:"VD: Concept 2D"}),r.includes.length>1&&e.jsx(w,{type:"button",variant:"ghost",size:"sm",onClick:()=>d(k),children:e.jsx(V,{className:"w-4 h-4 text-destructive"})})]},k))}),e.jsxs(w,{type:"button",variant:"outline",size:"sm",onClick:a,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Thêm mục"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(He,{checked:r.is_active,onCheckedChange:n=>s({...r,is_active:n})}),e.jsx(M,{children:"Hiển thị trên website"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>g(!1),children:"Hủy"}),e.jsx(w,{type:"submit",children:u?"Cập nhật":"Thêm"})]})]})]})]})]}),t.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx(ie,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Chưa có combo nào"}),e.jsxs(w,{className:"mt-4",onClick:T,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Thêm combo đầu tiên"]})]}):e.jsx("div",{className:"grid gap-4",children:t.map(n=>e.jsx("div",{className:`glass-card p-6 ${n.is_active?"":"opacity-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"cursor-move text-muted-foreground",children:e.jsx(ls,{className:"w-5 h-5"})}),e.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-r ${n.color} flex items-center justify-center`,children:e.jsx(ie,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-primary",children:n.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:n.description}),e.jsx("p",{className:"text-lg font-bold gradient-text",children:n.price}),n.includes.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:n.includes.map((k,S)=>e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-primary/10 text-primary",children:k},S))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{size:"sm",variant:"outline",onClick:()=>p(n),children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx(w,{size:"sm",variant:"destructive",onClick:()=>C(n.id),children:e.jsx(V,{className:"w-4 h-4"})})]})]})},n.id))})]})},Ls=()=>{const[t,c]=h.useState([]),[o,f]=h.useState(!0),[x,g]=h.useState(!1),u=async()=>{try{const{data:s,error:l}=await b.from("homepage_stats").select("*").order("display_order");if(l)throw l;c(s||[])}catch(s){console.error("Error fetching stats:",s),v({title:"Lỗi",description:"Không thể tải thống kê",variant:"destructive"})}finally{f(!1)}};h.useEffect(()=>{u()},[]);const j=(s,l,a)=>{c(d=>d.map(i=>i.id===s?{...i,[l]:a}:i))},r=async()=>{g(!0);try{for(const s of t){const{error:l}=await b.from("homepage_stats").update({stat_value:s.stat_value,stat_label:s.stat_label}).eq("id",s.id);if(l)throw l}v({title:"Thành công",description:"Đã cập nhật thống kê"})}catch(s){console.error("Error saving stats:",s),v({title:"Lỗi",description:"Không thể lưu thống kê",variant:"destructive"})}finally{g(!1)}};return o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"glass-card p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-display text-xl font-semibold",children:"Thống kê Hero Section"}),e.jsxs(w,{onClick:r,disabled:x,children:[x?e.jsx(I,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(os,{className:"w-4 h-4 mr-2"}),"Lưu thay đổi"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:t.map(s=>e.jsxs("div",{className:"space-y-4 p-4 rounded-lg bg-card/50 border border-border",children:[e.jsxs("div",{children:[e.jsx(M,{className:"text-xs text-muted-foreground uppercase",children:"Key"}),e.jsx("p",{className:"text-sm font-medium text-primary",children:s.stat_key})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:`value-${s.id}`,children:"Giá trị"}),e.jsx(E,{id:`value-${s.id}`,value:s.stat_value,onChange:l=>j(s.id,"stat_value",l.target.value),placeholder:"500+"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:`label-${s.id}`,children:"Nhãn"}),e.jsx(E,{id:`label-${s.id}`,value:s.stat_label,onChange:l=>j(s.id,"stat_label",l.target.value),placeholder:"ASSET 3D"})]})]},s.id))})]})},Ps=[{slug:"thiet-ke-2d",name:"Thiết Kế 2D",section:"deliverables"},{slug:"phim-truong-3d",name:"Thiết Kế 3D",section:"deliverables"},{slug:"model-3d",name:"Model 3D / Asset",section:"deliverables"},{slug:"noi-ngoai-that",name:"Nội Ngoại Thất",section:"deliverables"},{slug:"after-effects",name:"After Effects",section:"deliverables"}],Rs=()=>{const[t,c]=h.useState({}),[o,f]=h.useState(!0),[x,g]=h.useState(null);h.useEffect(()=>{u()},[]);const u=async()=>{try{const{data:s,error:l}=await b.from("category_page_images").select("*").eq("section_key","deliverables");if(l)throw l;const a={};s==null||s.forEach(d=>{a[d.category_slug]=d.image_url}),c(a)}catch(s){console.error("Error fetching images:",s)}finally{f(!1)}},j=async(s,l)=>{var d;const a=(d=l.target.files)==null?void 0:d[0];if(a){if(a.size>50*1024*1024){v({title:"Lỗi",description:"File quá lớn. Tối đa 50MB.",variant:"destructive"});return}g(s);try{const i=a.name.split(".").pop(),y=`deliverables/${s}-${Date.now()}.${i}`,{error:p}=await b.storage.from("category-images").upload(y,a);if(p)throw p;const{data:C}=b.storage.from("category-images").getPublicUrl(y),{error:D}=await b.from("category_page_images").upsert({category_slug:s,section_key:"deliverables",image_url:C.publicUrl},{onConflict:"category_slug,section_key"});if(D)throw D;v({title:"Đã cập nhật ảnh thành công"}),u()}catch(i){console.error("Upload error:",i),v({title:"Lỗi upload",description:"Không thể upload ảnh",variant:"destructive"})}finally{g(null)}}},r=async s=>{try{const{error:l}=await b.from("category_page_images").delete().eq("category_slug",s).eq("section_key","deliverables");if(l)throw l;v({title:"Đã xóa ảnh"}),u()}catch(l){console.error("Remove error:",l),v({title:"Lỗi",description:"Không thể xóa ảnh",variant:"destructive"})}};return o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-primary"})}):e.jsxs("div",{className:"glass-card p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"w-5 h-5 text-primary"}),e.jsx("h2",{className:"font-display text-xl font-semibold",children:"Ảnh Sản Phẩm Bàn Giao"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Cập nhật ảnh hiển thị trong phần "Sản Phẩm Bàn Giao" cho từng danh mục'}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Ps.map(s=>e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"aspect-video bg-card relative",children:t[s.slug]?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t[s.slug],alt:s.name,className:"w-full h-full object-cover"}),e.jsx(w,{size:"sm",variant:"destructive",className:"absolute top-2 right-2",onClick:()=>r(s.slug),children:e.jsx(le,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"w-full h-full flex items-center justify-center",children:[e.jsx(E,{type:"file",accept:"image/*",onChange:l=>j(s.slug,l),className:"hidden",id:`deliverable-${s.slug}`,disabled:x===s.slug}),e.jsx("label",{htmlFor:`deliverable-${s.slug}`,className:"cursor-pointer flex flex-col items-center gap-2",children:x===s.slug?e.jsx(I,{className:"w-8 h-8 animate-spin text-primary"}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-8 h-8 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Click để upload"})]})})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-primary",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Phần: Sản Phẩm Bàn Giao"}),t[s.slug]&&e.jsxs("div",{className:"mt-3",children:[e.jsx(E,{type:"file",accept:"image/*",onChange:l=>j(s.slug,l),className:"hidden",id:`replace-deliverable-${s.slug}`,disabled:x===s.slug}),e.jsx("label",{htmlFor:`replace-deliverable-${s.slug}`,children:e.jsx(w,{variant:"outline",size:"sm",className:"w-full",asChild:!0,children:e.jsxs("span",{children:[x===s.slug?e.jsx(I,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(z,{className:"w-4 h-4 mr-2"}),"Thay đổi ảnh"]})})})]})]})]},s.slug))})]})},je=[{slug:"thiet-ke-2d",name:"Thiết Kế 2D"},{slug:"3d-virtual",name:"3D Virtual"},{slug:"3d-event",name:"3D Event"},{slug:"model-3d",name:"Model 3D"},{slug:"noi-that",name:"Nội Thất"},{slug:"ngoai-that",name:"Ngoại Thất"},{slug:"after-effects",name:"After Effects"}],Ks=()=>{const[t,c]=h.useState(!0),[o,f]=h.useState(!1),[x,g]=h.useState(je[0].slug),u=es();h.useEffect(()=>{(async()=>{try{const{data:{session:l}}=await b.auth.getSession();if(!l){u("/admin/login");return}const{data:a,error:d}=await b.from("user_roles").select("role").eq("user_id",l.user.id).eq("role","admin").single();if(d||!a){v({title:"Không có quyền truy cập",description:"Bạn không phải là admin",variant:"destructive"}),u("/admin/login");return}f(!0)}catch(l){console.error("Auth check error:",l),u("/admin/login")}finally{c(!1)}})();const{data:{subscription:s}}=b.auth.onAuthStateChange(l=>{l==="SIGNED_OUT"&&u("/admin/login")});return()=>s.unsubscribe()},[u]);const j=async()=>{await b.auth.signOut(),u("/admin/login")};return t?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-primary"})}):o?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b border-border bg-card/50 backdrop-blur-xl sticky top-0 z-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:"/lovable-uploads/1052d8d6-1118-4206-be15-c73ee5a0188e.png",alt:"DesignHomeKey",className:"h-8"}),e.jsx("h1",{className:"font-display text-lg font-semibold",children:"Admin Dashboard"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(w,{variant:"ghost",onClick:()=>u("/"),size:"sm",children:"Xem website"}),e.jsxs(w,{variant:"outline",onClick:j,size:"sm",children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Đăng xuất"]})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs(ss,{defaultValue:"images",className:"space-y-6",children:[e.jsxs(ts,{className:"grid w-full max-w-3xl grid-cols-5",children:[e.jsxs(K,{value:"images",className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"Ảnh"]}),e.jsxs(K,{value:"pricing",className:"flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Bảng giá"]}),e.jsxs(K,{value:"combo",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Combo"]}),e.jsxs(K,{value:"stats",className:"flex items-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),"Thống kê"]}),e.jsxs(K,{value:"homepage",className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-4 h-4"}),"Trang chủ"]})]}),e.jsxs(B,{value:"images",className:"space-y-6",children:[e.jsxs("div",{className:"glass-card p-4",children:[e.jsx("h2",{className:"font-semibold mb-3",children:"Chọn danh mục"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:je.map(r=>e.jsx(w,{variant:x===r.slug?"default":"outline",size:"sm",onClick:()=>g(r.slug),children:r.name},r.slug))})]}),e.jsx(ms,{categorySlug:x})]}),e.jsx(B,{value:"pricing",children:e.jsx(_s,{})}),e.jsx(B,{value:"combo",children:e.jsx(Is,{})}),e.jsx(B,{value:"stats",children:e.jsx(Ls,{})}),e.jsxs(B,{value:"homepage",className:"space-y-6",children:[e.jsx(ks,{}),e.jsx(Rs,{})]})]})})]}):null};export{Ks as default};
