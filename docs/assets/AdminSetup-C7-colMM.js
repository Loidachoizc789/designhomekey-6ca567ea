import{r as a,D as A,j as e,B as f,I as l,q as c,E as n}from"./index-Cz-rwPxk.js";import{L as g,a as o}from"./label-zMVBXziF.js";const C=()=>{const[d,j]=a.useState(""),[i,v]=a.useState(""),[m,w]=a.useState(""),[h,u]=a.useState(!1),[k,y]=a.useState(!0),[b,N]=a.useState(!1),p=A();a.useEffect(()=>{(async()=>{try{const{data:s,error:r}=await c.from("user_roles").select("id").eq("role","admin").limit(1);if(r)throw r;N(s&&s.length>0)}catch(s){console.error("Error checking admin:",s)}finally{y(!1)}})()},[]);const E=async t=>{if(t.preventDefault(),i!==m){n({title:"Lỗi",description:"Mật khẩu xác nhận không khớp",variant:"destructive"});return}if(i.length<6){n({title:"Lỗi",description:"Mật khẩu phải có ít nhất 6 ký tự",variant:"destructive"});return}u(!0);try{const{data:s,error:r}=await c.auth.signUp({email:d,password:i});if(r)throw r;if(s.user){const{error:x}=await c.from("user_roles").insert({user_id:s.user.id,role:"admin"});if(x)throw x;n({title:"Thành công",description:"Tài khoản admin đã được tạo. Vui lòng kiểm tra email để xác nhận."}),p("/admin/login")}}catch(s){console.error("Setup error:",s),n({title:"Lỗi",description:s instanceof Error?s.message:"Đã xảy ra lỗi khi tạo tài khoản",variant:"destructive"})}finally{u(!1)}};return k?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(g,{className:"w-8 h-8 animate-spin text-primary"})}):b?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-card p-8 max-w-md w-full text-center",children:[e.jsx("h1",{className:"font-display text-2xl font-bold mb-4",children:"Admin Đã Tồn Tại"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Hệ thống đã có tài khoản admin. Vui lòng đăng nhập."}),e.jsx(f,{onClick:()=>p("/admin/login"),className:"w-full",children:"Đến trang đăng nhập"})]})}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-card p-8 max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("img",{src:"/lovable-uploads/1052d8d6-1118-4206-be15-c73ee5a0188e.png",alt:"DesignHomeKey",className:"h-16 mx-auto mb-4"}),e.jsx("h1",{className:"font-display text-2xl font-bold",children:"Tạo Tài Khoản Admin"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Đây là lần setup đầu tiên. Tạo tài khoản admin để quản lý website."})]}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"email",children:"Email"}),e.jsx(l,{id:"email",type:"email",value:d,onChange:t=>j(t.target.value),placeholder:"admin@example.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"password",children:"Mật khẩu"}),e.jsx(l,{id:"password",type:"password",value:i,onChange:t=>v(t.target.value),placeholder:"••••••••",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"confirmPassword",children:"Xác nhận mật khẩu"}),e.jsx(l,{id:"confirmPassword",type:"password",value:m,onChange:t=>w(t.target.value),placeholder:"••••••••",required:!0})]}),e.jsxs(f,{type:"submit",className:"w-full",disabled:h,children:[h&&e.jsx(g,{className:"w-4 h-4 mr-2 animate-spin"}),"Tạo tài khoản Admin"]})]})]})})};export{C as default};
